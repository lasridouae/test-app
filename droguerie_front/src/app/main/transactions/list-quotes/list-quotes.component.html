<div class="content-wrapper container-xxl p-0">
    <div class="content-body">
        <!-- content-header component -->
        <app-content-header [contentHeader]="contentHeader"></app-content-header>

        <section id="input-group-basic-merged" class="basic-select card">
            <div class="row match-height card-body">
                <div class="col-12 col-md-3">
                    <div class="input-group mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon-search1"><i data-feather="search"></i></span>
                        </div>
                        <input [(ngModel)]="search" type="text" class="form-control search-product" id="input-search"
                            placeholder="Search by : Total order" aria-label="Search..." aria-describedby="input-search"
                            (ngModelChange)="searchFunc(customer,product,search)" />
                    </div>
                </div>
                <div class="col-12 col-md-3">
                    <div class="form-group">

                        <ng-select [items]="products" [(ngModel)]="product"
                            (change)="searchFunc(customer,product,search)" [ngModelOptions]="{standalone: true}"
                            placeholder="Search by product ..."> 
                            <ng-template ng-option-tmp ng-label-tmp let-item="item" bindLabel="name" bindValue="item">
                                <img class="rounded-circle mr-1" [src]="this.item.photos ? USER_IMAGE_PATH + this.item.photos : 'assets/images/default_images/simple_product.png'"
                                    alt="product-photo" height="32" width="32" />
                                {{ item.name }}
                            </ng-template>
                        </ng-select>
                    </div>
                </div>
                <div class="col-12 col-md-3">
                    <div class="form-group">
                        <ng-select
                            [items]="paramType == 'purchase' || ( paramType == 'invoice' && paramInOut == 'in') ? fournisseurs: clients "
                            bindLabel="name" [loading]="!content_loaded" [(ngModel)]="customer"
                            (change)="searchFunc(customer,product,search)"
                            placeholder="Search by {{paramType == 'purchase' || ( paramType == 'invoice' && paramInOut == 'in') ? 'fournisseur' : 'client'}} ...">
                        </ng-select>
                    </div>
                </div>


                <div class="col-12 col-sm-12 col-md-3 col-lg-3 mb-1">
                    <div class="subtext-text" style="text-align: center">
                        <button (click)="searchFunc(customer,product,search)" type="button"
                            class="btn btn-primary btn-block toggle-button" rippleEffect>
                            <span [data-feather]="'filter'" [class]="'mr-25'"></span>Filter
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="ngx-datatable-kitchen-sink">
            <div class="card">
                <div class="row py-1 d-flex justify-content-end">
                    <div class="col-md-6 col-12" *ngIf="paramType != 'invoice'">
                        <button class="btn btn-primary ml-1" rippleEffect routerLink="/transactions/{{paramType}}/add">
                            <i data-feather="plus" class="mr-0 mr-sm-1"></i><span class="d-none d-sm-inline-block">Ajouter nouveau
                                {{paramType}}</span>
                        </button>

                      

                    </div>
                    <div class="col-md-6 col-12 d-flex justify-content-md-end">
                        <div class="d-flex align-items-center justify-content-end pr-1 pb-1 pl-1 pl-md-0 pb-md-0">
                            <label class="d-flex align-items-center">Search<input type="search"
                                    placeholder="Search by Date" class="form-control ml-25"
                                    (keyup)="filterUpdate($event)" (search)="filterUpdate($event)" /></label>
                        </div>
                        <a (click)="this.exportData.exportAsExcelFile(quotes ? quotes : orders,paramType)" class="btn btn-outline-secondary float-right mr-1" rippleEffect
                        >Exporter Excel</a>
                    </div>
                </div>
                <ngx-datatable *ngIf="this.content_loaded == true" class="bootstrap core-bootstrap" [headerHeight]="40"
                    [rowHeight]="58" [limit]="10" [columnMode]="ColumnMode.force" [footerHeight]="25"
                    [rows]="quotes ? quotes : orders" [scrollbarH]="true">

                    <ngx-datatable-column [width]="180" name="Date" prop="transaction_date">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row"
                            let-value="value">
                            <div title="Double click to edit">
                                <p class="font-medium-1 line-height-1 mb-0" *ngIf="quotes && !orders">{{
                                    row.order[0].date | date }}</p>
                                <p class="font-medium-1 line-height-1 mb-0" *ngIf="!quotes && orders">{{ row.date | date }}</p>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="30" name="Id" prop="id">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row"
                            let-value="value">
                            <div title="Double click to edit">
                                <p class="font-medium-1 line-height-1 mb-0">{{ value }}</p>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="180" *ngIf="paramType != 'simple_sale' "
                        name="{{paramType == 'quote' || ( paramType == 'invoice' && paramInOut == 'out') || paramType == 'sale' ? 'Client' : 'Fournisseur' }}"
                        prop="customer">

                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row"
                            let-value="value">
                            <div title="Double click to edit">
                                <p class="font-medium-1 line-height-1 mb-0"
                                    *ngIf="paramType == 'quote' || ( paramType == 'invoice' && paramInOut == 'out')">{{
                                    row.order[0].client.name }}</p>
                                <p class="font-medium-1 line-height-1 mb-0"
                                    *ngIf="paramType == 'sale'">{{ row.client.name }}</p>
                                <p class="font-medium-1 line-height-1 mb-0" *ngIf="paramType == 'purchase'">{{
                                    row.fournisseur.name }}</p>
                                <p class="font-medium-1 line-height-1 mb-0"
                                    *ngIf="paramType == 'invoice' && paramInOut == 'in'">{{
                                    row.order[0].fournisseur? row.order[0].fournisseur.name : '' }}</p>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="30" name="Grand Total" prop="grand_total">
                        <ng-template ngx-datatable-cell-template let-value="value" let-rowIndex="rowIndex"
                            let-row="row">
                            <div title="Double click to edit text-center">
                                <div class="badge badge-block badge-primary" *ngIf="quotes && !orders">{{
                                    row.order[0].grand_total }} MAD</div>
                                <div class="badge badge-block badge-primary" *ngIf="!quotes && orders">{{
                                    row.grand_total }} MAD</div>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="100" name="Number of Products" prop="nbr_product">
                        <ng-template ngx-datatable-cell-template let-value="value" let-rowIndex="rowIndex"
                            let-row="row">
                            <div title="Double click to edit text-center" *ngIf="quotes && !orders">{{
                                row.order[0].order_details.length }}</div>
                            <div title="Double click to edit text-center" *ngIf="!quotes && orders">{{
                                row.order_details.length }}</div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="50" name="Status" prop="payment_status" *ngIf="paramType == 'invoice'">
                        <ng-template ngx-datatable-cell-template let-value="value" let-rowIndex="rowIndex"
                            let-row="row">
                            <div title="Double click to edit text-center">
                                <div class="badge badge-block {{row.order[0].payment_status == 'paid' ? 'badge-success' : 'badge-warning'}}" >{{
                                    row.order[0].payment_status }}</div>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="Actions" [width]="60" [sortable]="false">
                        <ng-template ngx-datatable-cell-template let-value="value" let-rowIndex="rowIndex"
                            let-row="row">
                            <div class="d-flex align-items-center">
                                <div ngbDropdown container="body">
                                    <a ngbDropdownToggle href="javascript:void(0);" class="hide-arrow"
                                        id="dropdownBrowserState" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i data-feather="more-vertical" class="text-primary cursor-pointer mr-50"></i>
                                    </a>
                                    <div ngbDropdownMenu class="dropdown-menu-right"
                                        aria-labelledby="dropdownBrowserState">
                                        <a ngbDropdownItem (click)="deleteItem(row)"
                                            class="d-flex align-items-center"><i data-feather="trash-2"
                                                class="mr-50"></i> Supprimer</a>

                                        <a ngbDropdownItem *ngIf="paramType == 'quote'"
                                            routerLink="/transactions/generate/sale/{{row.id}}"
                                            class="d-flex align-items-center">
                                            <i data-feather="file-plus" class="mr-50"></i> Généger Vente</a>

                                        <a ngbDropdownItem *ngIf="paramType == 'purchase'"
                                            (click)="generateInvoice(row , 'in')"
                                            class="d-flex align-items-center">
                                            <i data-feather="file-plus" class="mr-50"></i> Générer une facture</a>

                                        <a ngbDropdownItem *ngIf="paramType == 'sale'"
                                            (click)="generateInvoice(row , 'out')"
                                            class="d-flex align-items-center">
                                            <i data-feather="file-plus" class="mr-50"></i> Générer une facture</a>
                                    </div>
                                </div>

                                <a *ngIf="paramType != 'invoice'"
                                    routerLink="/transactions/{{paramType}}/edit/{{row.id}}">
                                    <i data-feather="edit" class="text-primary cursor-pointer"></i>
                                </a>

                                <a *ngIf="paramType == 'invoice'"
                                    routerLink="/transactions/{{paramType}}/edit/{{paramInOut}}/{{row.id}}">
                                    <i data-feather="edit" class="text-primary cursor-pointer"></i>
                                </a>

                                <a routerLink="/transactions/{{paramType}}/preview/{{row.id}}" class="ml-1">
                                    <i data-feather="eye" class="text-primary cursor-pointer"></i>
                                </a>

                                <a *ngIf="paramType == 'invoice'"
                                    (click)="showPaymentMethodModal(modalPM,row.order[0])" class="ml-1">
                                    <i data-feather="credit-card" class="text-primary cursor-pointer"></i>
                                </a>
                            </div>

                            <!-- Modal -->
                            <ng-template #modalPM let-modal> <!--  *ngIf="paramType == 'invoice'"-->
                                <div class="modal-header">
                                    <h4 class="modal-title" id="myModalLabel1">Méthode de paiement</h4>
                                    <button type="button" class="close" (click)="modal.dismiss('Cross click')"
                                        aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body" tabindex="0" ngbAutofocus>
                                    <div class="row mb-2" *ngIf="orderSelectedHasPM == false"> <!---->
                                        <div class="col-12">
                                            <select class="form-control" id="status" name="status"
                                                [(ngModel)]="this.paymentMethodSelected"
                                                (change)="onChangeSelectPM($event)">
                                                <option value="" selected>Séléctionner Méthode de paiement</option>
                                                <option value="cash">Cash</option>
                                                <option value="cheque">Chéque</option>
                                                <option value="credit">Crédit</option>
                                                <option value="traite">Traite</option>
                                            </select>
                                        </div>
                                        <hr class="invoice-spacing" />

                                    </div>


                                    <!--------------------- Form Add Payment Method 'Cash' START--------------------->
                                    <form *ngIf="paymentMethodSelected == 'cash'" (ngSubmit)="(CashForm.form.valid)"
                                        #CashForm="ngForm">
                                        <div class="form-group ">
                                            <label>Montant: </label>
                                            <input type="number" placeholder="Amount" name="amount" class="form-control"
                                                [(ngModel)]="this.cash.amount" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="CashForm.submitted && FAmountRef.invalid"
                                                #FAmountRef="ngModel" required />

                                            <span *ngIf="CashForm.submitted && FAmountRef.invalid" class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FAmountRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group ">
                                            <label>Date paiemant: </label>
                                            <ng2-flatpickr [config]="DefaultDatePaymentOptions" name="date_payment"
                                                [(ngModel)]="this.cash.date_payment" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="CashForm.submitted && FDatePaymentRef.invalid"
                                                #FDatePaymentRef="ngModel" required name="date_payment"></ng2-flatpickr>

                                            <span *ngIf="CashForm.submitted && FDatePaymentRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FDatePaymentRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group d-flex justify-content-around align-items-center ">
                                            <button type="submit" class="btn btn-primary "
                                                (click)="savePaymentMethod(modal,CashForm,row.order[0],'cash')" rippleEffect>
                                                Enregistrer
                                            </button>
                                            <button *ngIf="this.cash.id != null" type="submit"
                                                class="btn btn-danger "
                                                (click)="deletePaymentMethod(modal, this.cash,'cashes')" rippleEffect>
                                                Supprimer
                                            </button>
                                        </div>
                                    </form>
                                    <!--------------------- Form Add Payment Method 'Cash' END--------------------->

                                    <!--------------------- Form Add Payment Method 'Cheque' START --------------------->
                                    <form *ngIf="paymentMethodSelected == 'cheque'" (ngSubmit)="(ChequeForm.form.valid)"
                                        #ChequeForm="ngForm">
                                        <div class="form-group ">
                                            <label>Naom de la banque: </label>
                                            <input type="text" placeholder="Name of Bank" name="name_bank"
                                                class="form-control" [(ngModel)]="this.cheque.name_bank" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FNameBankRef.invalid"
                                                #FNameBankRef="ngModel" required />

                                            <span *ngIf="ChequeForm.submitted && FNameBankRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FNameBankRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group ">
                                            <label>Numéro de chéque: </label>
                                            <input type="number" placeholder="Num of Cheque" name="num_cheque"
                                                class="form-control" [(ngModel)]="this.cheque.num_cheque" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FNnumChequeRef.invalid"
                                                #FNnumChequeRef="ngModel" required />

                                            <span *ngIf="ChequeForm.submitted && FNnumChequeRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FNnumChequeRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group ">
                                            <label>Montant: </label>
                                            <input type="number" placeholder="Amount" name="amount" class="form-control"
                                                [(ngModel)]="this.cheque.amount" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FAmountRef.invalid"
                                                #FAmountRef="ngModel" required />

                                            <span *ngIf="ChequeForm.submitted && FAmountRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FAmountRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group " *ngIf="row.order[0].fournisseur_id && !row.order[0].client_id">
                                            <label>Date Decaissement: </label>
                                            <ng2-flatpickr [config]="DefaultDatePaymentOptions" name="date_decaissement"
                                                [(ngModel)]="this.cheque.date_decaissement" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FDateDecaissementRef.invalid"
                                                #FDateDecaissementRef="ngModel" required></ng2-flatpickr>

                                            <span *ngIf="ChequeForm.submitted && FDateDecaissementRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FDateDecaissementRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group " *ngIf="!row.order[0].fournisseur_id && row.order[0].client_id">
                                            <label>Date Encaissement: </label>
                                            <ng2-flatpickr [config]="DefaultDatePaymentOptions" name="date_encaissement"
                                                [(ngModel)]="this.cheque.date_encaissement" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FDateEncaissementRef.invalid"
                                                #FDateEncaissementRef="ngModel" required></ng2-flatpickr>

                                            <span *ngIf="ChequeForm.submitted && FDateEncaissementRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FDateEncaissementRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group">
                                            <label for="status">Status de paiement</label>
                                            <select class="form-control" id="status" name="status"
                                                [(ngModel)]="this.cheque.status" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="ChequeForm.submitted && FPaymentStatusRef.invalid"
                                                #FPaymentStatusRef="ngModel" required>
                                                <option value="A DEPOSER">A DEPOSER
                                                </option>
                                                <option value="DEPOSER">DEPOSER</option>
                                                <option value="ENCAISSE">ENCAISSE</option>
                                                <option value="IMPAYE">IMPAYE</option>
                                            </select>

                                            <span *ngIf="ChequeForm.submitted && FPaymentStatusRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FPaymentStatusRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group d-flex justify-content-around align-items-center">
                                            <button type="submit" class="btn btn-primary "
                                                (click)="savePaymentMethod(modal,ChequeForm,row.order[0],'cheque')" rippleEffect>
                                                Enregister
                                            </button>
                                            <button *ngIf="this.cheque.id != null"
                                                type="submit" class="btn btn-danger "
                                                (click)="deletePaymentMethod(modal, this.cheque,'cheques')" rippleEffect>
                                                Supprimer
                                            </button>
                                        </div>
                                    </form>
                                    <!--------------------- Form Add Payment Method 'Cheque' END --------------------->

                                    <!--------------------- Form Add Payment Method 'Credit' START --------------------->
                                    <form *ngIf="paymentMethodSelected == 'credit'" (ngSubmit)="(CreditForm.form.valid)"
                                        #CreditForm="ngForm">

                                        <div class="form-group ">
                                            <label>Montant: </label>
                                            <input type="number" placeholder="Amount" name="amount" class="form-control"
                                                [(ngModel)]="this.credit.amount" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="CreditForm.submitted && FAmountRef.invalid"
                                                #FAmountRef="ngModel" required />

                                            <span *ngIf="CreditForm.submitted && FAmountRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FAmountRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group ">
                                            <label>Date approche: </label>
                                            <ng2-flatpickr [config]="DefaultDatePaymentOptions" name="approaching_date"
                                                [(ngModel)]="this.credit.approaching_date" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="CreditForm.submitted && FDateApproachingRef.invalid"
                                                #FDateApproachingRef="ngModel" required
                                                name="approaching_date"></ng2-flatpickr>

                                            <span *ngIf="CreditForm.submitted && FDateApproachingRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FDateApproachingRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group">
                                            <label for="payment_status">Status de paiement</label>
                                            <select class="form-control" id="payment_status" name="payment_status"
                                                [(ngModel)]="this.credit.payment_status" [ngModelOptions]="{standalone: true}" 
                                                [class.error]="CreditForm.submitted && FPaymentStatusRef.invalid"
                                                #FPaymentStatusRef="ngModel" required>
                                                <option value="unpaid">Non payé</option>
                                                <option value="paid">Payé</option>
                                            </select>

                                            <span *ngIf="CreditForm.submitted && FPaymentStatusRef.invalid"
                                                class="invalid-form">
                                                <small class="form-text text-danger"
                                                    *ngIf="FPaymentStatusRef.errors.required">Ce champ est obligatoire!</small>
                                            </span>
                                        </div>
                                        <div class="form-group d-flex justify-content-around align-items-center">
                                            <button type="submit" class="btn btn-primary "
                                                (click)="savePaymentMethod(modal,CreditForm,row.order[0],'credit')" rippleEffect>
                                                Enregister
                                            </button>
                                            <button *ngIf="this.credit.id != null"
                                                type="submit" class="btn btn-danger "
                                                (click)="deletePaymentMethod(modal, this.credit,'credits')" rippleEffect>
                                                Supprimer
                                            </button>
                                        </div>
                                    </form>
                                    <!--------------------- Form Add Payment Method 'Credit' END --------------------->

                                    <!--------------------- Form Add Payment Method 'Traite' START --------------------->
                                    <div *ngIf="paymentMethodSelected == 'traite'">
                                        <div class="row">
                                            <div
                                                class="col-4 d-flex justify-content-center align-items-center flex-column ">
                                                <div class="avatar bg-light-primary p-50 m-0">
                                                    <div class="avatar-content">
                                                        <i data-feather="file" class="text-primary"></i>
                                                    </div>
                                                </div>
                                                <h4 class="font-weight-bolder mt-1">{{this.traite.payment_status ?
                                                    this.traite.payment_status : 'unpaid'}}</h4>
                                                <p class="mb-0">Status de paiement</p>
                                            </div>
                                            <div
                                                class="col-4 d-flex justify-content-center align-items-center flex-column ">
                                                <div class="avatar bg-light-primary p-50 m-0">
                                                    <div class="avatar-content">
                                                        <i data-feather="dollar-sign" class="text-primary"></i>
                                                    </div>
                                                </div>
                                                <h4 class="font-weight-bolder mt-1">{{this.traite.amount_paid }} MAD</h4>
                                                <p class="mb-0">Montant payé</p>
                                            </div>
                                            <div
                                                class="col-4 d-flex justify-content-center align-items-center flex-column ">
                                                <div class="avatar bg-light-primary p-50 m-0">
                                                    <div class="avatar-content">
                                                        <i data-feather="dollar-sign" class="text-primary"></i>
                                                    </div>
                                                </div>
                                                <h4 class="font-weight-bolder mt-1">{{this.traite.nbr_traites ?
                                                    this.traite.nbr_traites : 0}}</h4>
                                                <p class="mb-0">Nombre des traites</p>
                                            </div>
                                        </div>
                                        <form (ngSubmit)="(TraiteForm.form.valid)" #TraiteForm="ngForm" class="mt-1">

                                            <div data-repeater-list="group-a">
                                                <div class="repeater-wrapper div-custom-traitesDetailModal my-1"
                                                    data-repeater-item
                                                    *ngFor="let traiteDetail of traite_details; let i = index"
                                                    (change)="onChangeTraiteDetails(traiteDetail , i)">
                                                    <div class="row w-100">
                                                        <div class="form-group col-3">
                                                            <label>Montant: </label>
                                                            <input type="number" placeholder="Amount" name="amount"
                                                                class="form-control" [(ngModel)]="traiteDetail.amount" [ngModelOptions]="{standalone: true}" 
                                                                [class.error]="TraiteForm.submitted && FAmountRef.invalid"
                                                                #FAmountRef="ngModel" required />

                                                            <span *ngIf="TraiteForm.submitted && FAmountRef.invalid"
                                                                class="invalid-form">
                                                                <small class="form-text text-danger"
                                                                    *ngIf="FAmountRef.errors.required">Ce champ est obligatoire!</small>
                                                            </span>
                                                        </div>
                                                        <div class="form-group col-4">
                                                            <label>Date Approche: </label>
                                                            <input type="date" class="form-control invoice-edit-input" type="date" (change)="changeDateTraiteDetail($event,i)"
                                                            required  [value]="traiteDetail.approaching_date | date:'yyyy-MM-dd'"/>
                                                        </div>
                                                        <div class="form-group col-4">
                                                            <label for="payment_status">Status de paiement</label>
                                                            <select class="form-control" id="payment_status"
                                                                name="payment_status"
                                                                [(ngModel)]="traiteDetail.payment_status" [ngModelOptions]="{standalone: true}" 
                                                                [class.error]="TraiteForm.submitted && FPaymentStatusRef.invalid"
                                                                #FPaymentStatusRef="ngModel" required>
                                                                <option value="unpaid">Non payé
                                                                </option>
                                                                <option value="paid">Payé</option>
                                                            </select>

                                                            <span
                                                                *ngIf="TraiteForm.submitted && FPaymentStatusRef.invalid"
                                                                class="invalid-form">
                                                                <small class="form-text text-danger"
                                                                    *ngIf="FPaymentStatusRef.errors.required">Ce champ est obligatoire!</small>
                                                            </span>
                                                        </div>
                                                        <div
                                                            class="col-1 d-flex justify-content-center align-items-center">
                                                            <a (click)="deleteTraiteDetail(i)"
                                                                class="d-flex align-items-center"><i
                                                                    data-feather="trash-2" class="mr-50"></i> </a>
                                                        </div>

                                                        <div
                                                            class="row w-100 mt-1 d-flex justify-content-around align-items-center">
                                                            <button type="button"
                                                                class="btn btn-success btn-sm btn-add-new"
                                                                *ngIf="!traiteDetail.id && this.traite.id"
                                                                (click)="addTraiteDetailDB(traiteDetail, i)"
                                                                rippleEffect>
                                                                <i data-feather="save" class="mr-25"></i>
                                                                <span class="align-middle">Save Item</span>
                                                            </button>
                                                            <button type="button"
                                                                class="btn btn-warning btn-sm btn-add-new"
                                                                *ngIf="traiteDetail.id && traiteDetail.updated && this.traite.id"
                                                                (click)="updateTraiteDetailDB(traiteDetail, i)"
                                                                rippleEffect>
                                                                <i data-feather="edit" class="mr-25"></i>
                                                                <span class="align-middle">Modifier article</span>
                                                            </button>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-1">
                                                <div class="col-12 px-0">
                                                    <button type="button" class="btn btn-primary btn-sm btn-add-new"
                                                        (click)="addTraiteDetail()" rippleEffect>
                                                        <i data-feather="plus" class="mr-25"></i>
                                                        <span class="align-middle">Ajouter article</span>
                                                    </button>
                                                </div>
                                            </div>

                                        </form>
                                        <div class="row w-100 mt-2">
                                            <div class="col 12 d-flex justify-content-around align-items-center">
                                                <div
                                                    class="form-group d-flex justify-content-around align-items-center">
                                                    <button *ngIf="this.traite.id == null" type="submit"
                                                        class="btn btn-primary "
                                                        (click)="savePaymentMethod(modal,TraiteForm,row.order[0],'traite')"
                                                        rippleEffect>
                                                        Enregistrer Traite Global
                                                    </button>
                                                    <button *ngIf="row.payment_type != ''  && this.traite.id != null"
                                                        type="submit" class="btn btn-danger "
                                                        (click)="deletePaymentMethod(modal, this.traite,'traites')"
                                                        rippleEffect>
                                                        Supprimer Traite Global
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--------------------- Form Add Payment Method 'Traite' END --------------------->

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-danger"
                                        (click)="modal.close('Accept click')" rippleEffect>
                                        Annuler
                                    </button>
                                </div>
                            </ng-template>
                            <!-- / Modal -->

                        </ng-template>
                    </ngx-datatable-column>
                </ngx-datatable>

                <!-- loading Card -->
                <div class="card h-100 shadow-none" *ngIf="this.content_loaded == false">
                    <div class="card-body d-flex justify-content-center align-items-center ">
                        <app-loading-card></app-loading-card>
                    </div>
                </div>
                <!-- / loading Card -->

                <div *ngIf="this.content_loaded == true " class="col-12 col-md-12 col-lg-12">
                    <app-no-data-card></app-no-data-card>
                </div>
            </div>
        </section>
    </div>
</div>